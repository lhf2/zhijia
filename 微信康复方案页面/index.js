define(["jquery","app","require","validation","profile","auth","nativeMethod","verify"],function(a,b,c,d,e,f,g,h){var i="",j={phone:/\d{11}/i,code:/\d{6}/i,password:/.{6,13}/i},k={name_required:"璇疯緭鍏ユ偍鐨勫鍚嶃€�",mobile_required:"璇疯緭鍏ユ偍鐨勬墜鏈哄彿鐮併€�",code_required:"璇疯緭鍏ユ敹鍒扮殑6浣嶇煭淇￠獙璇佺爜銆�",password_required:"璇疯緭鍏ユ偍鐨勫瘑鐮�",require_code:"璇风偣鍑汇€愮偣鍑昏幏鍙栥€戞寜閽紝鐢宠楠岃瘉鐮併€�",code_sent:"楠岃瘉鐮佸凡鍙戦€併€�",succeed:" 鎵嬫満鍙风爜楠岃瘉鎴愬姛锛�",accountRequired:"鎵嬫満鍙峰凡瀛樺湪锛岃涓嬭浇寰硸App鐩存帴鐧诲綍鍚с€�"},l=!1,m=function(b){i=b,a("#loginTitle").text(b),i&&a(".reg a").attr("href","#me/reg::url="+i)},n=function(){a("#mobile").blur(function(){d.checkMobile("#mobile")}),a("#passwd").blur(function(){d.checkFieldLength(6,20,"#passwd","璇疯緭鍏ユ纭殑瀵嗙爜")}),a("#btnSubmit").on("click",function(a){o(a)}),a("#mobile").focus(function(){a(this).select()}),a("#passwd").focus(function(){a(this).select()});var c=a(".form");c.on("click",'[data-event="switch"]',function(){c.toggleClass("login-by-sms login-by-password")});var e,f=a("#mobile"),g=a("#passwd"),i=a("#btnCode");c.on("click",'[data-event="code"]',function(){var a=f.val();if(!a||!j.phone.test(a))return void b.tipAlert(k.mobile_required);g.focus(),f.prop("readonly",!0),e&&e.stop(),i.prop("disabled",!0),e=h.getIntervalTimer(1e3,function(a){i.val("鍐嶆鑾峰彇("+(59-a)+")"),a>=59&&(e.stop(),f.prop("readonly",!1),i.val("鐐瑰嚮鑾峰彇"),i.prop("disabled",!1))}),e.start(),h.getVerifyCode(a,8).done(function(){l=!0,b.tipAlert(k.code_sent)}).fail(function(a){100001===a.status&&b.modalAlert("鎻愮ず",k.accountRequired),e&&e.stop(),f.prop("readonly",!1),i.val("鍐嶆鑾峰彇"),i.prop("disabled",!1)})})},o=function(b){if(!d.checkMobile("#mobile"))return!1;if(b.preventDefault(),a(".form").hasClass("login-by-sms")){if(!d.checkFieldLength(6,20,"#inputCode","璇疯緭鍏ユ纭殑楠岃瘉鐮�"))return!1;e.smsLogin({phoneNum:a("#mobile").val(),verificationCode:a("#inputCode").val()}).then(p,function(){a("#btnSubmit").button("reset")})}else{if(!d.checkFieldLength(6,20,"#passwd","璇疯緭鍏ユ纭殑瀵嗙爜"))return!1;e.login({phoneNum:a("#mobile").val(),password:a("#passwd").val(),deviceId:"webapp_patient"},p).fail(function(){a("#btnSubmit").button("reset")})}},p=function(c){if(0==c.status){var d=c.domain.legacy;c.domain.user&&(d.name=c.domain.user.name,d.avatar=c.domain.user.avatar);var e=c.domain.legacy.userId;d.user_id=e,d.userId=e,d.decryptedSessionId="";var g=JSON.stringify(d);c.domain.new.accessId,c.domain.new.accessKey;if(f.cookie("webapp_patient",g),f.cookie("webapp_user",g),i){if("xiaobang"===i){var h="";h=101<e?"101_"+e:e+"_101",i="message/chat::threadId="+h+"&doctorId=101"}window.location=b.BASE_URL+i}else window.location=b.BASE_URL+"me/index"}else a("#btn-login").text("鐧诲綍"),b.tipAlert(c.error_msg,3)};return{init:function(){b.initBaseFontSize(750),g.setTitle("鐧诲綍");var c;sessionStorage&&(c=sessionStorage.getItem("welltang-service-jd-healthy")),c&&a(".login-footer").hide();var d=b.getParams();try{if(d.url){var e=decodeURIComponent(d.url);m(e)}}catch(a){}d.signout&&b.deleteAllCookies(),n()},setUrl:m,signIn:o,cbSignIn:p}});